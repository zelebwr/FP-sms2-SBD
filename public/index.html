<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Project Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .section-content {
            padding: 30px;
        }

        .database-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .database-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid;
        }

        .mysql-card {
            border-left-color: #1976d2;
        }

        .mongodb-card {
            border-left-color: #2e7d32;
        }

        .database-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .database-title {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-connected {
            background: #4caf50;
        }

        .status-disconnected {
            background: #f44336;
        }

        .database-info {
            display: grid;
            gap: 12px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: #555;
        }

        .info-value {
            color: #333;
            font-weight: 600;
        }

        .collections-list, .tables-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .collection-item, .table-item {
            padding: 5px 10px;
            margin: 3px 0;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #c33;
        }

        .success {
            background: #efe;
            color: #363;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #363;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }

        .summary-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .database-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                üóÑÔ∏è Database Project Dashboard
            </h1>
            <p>Real-time monitoring untuk MySQL dan MongoDB</p>
        </div>

        <!-- Summary Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalDatabases">-</div>
                <div class="stat-label">Databases Connected</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTables">-</div>
                <div class="stat-label">MySQL Tables</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCollections">-</div>
                <div class="stat-label">MongoDB Collections</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRecords">-</div>
                <div class="stat-label">Total Records</div>
            </div>
        </div>

        <!-- Database Status Section -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üîç Database Connection Status
                </div>
                <button class="refresh-btn" onclick="loadDashboardStatus()">Refresh Status</button>
            </div>
            <div class="section-content">
                <div id="dashboardStatusContent">
                    <div class="loading">Loading database status...</div>
                </div>
            </div>
        </div>

        <!-- Data Sections -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üë• Users Data
                </div>
                <button class="refresh-btn" onclick="loadUsers()">Refresh</button>
            </div>
            <div class="section-content">
                <div id="usersContent">
                    <div class="loading">Loading users...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üì¶ Products & Items
                </div>
                <button class="refresh-btn" onclick="loadItems()">Refresh</button>
            </div>
            <div class="section-content">
                <div id="itemsContent">
                    <div class="loading">Loading items...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üìÇ Categories
                </div>
                <button class="refresh-btn" onclick="loadCategories()">Refresh</button>
            </div>
            <div class="section-content">
                <div id="categoriesContent">
                    <div class="loading">Loading categories...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let dashboardData = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Dashboard initializing...');
            loadDashboard();
        });

        // Main dashboard loader
        async function loadDashboard() {
            console.log('üìä Loading complete dashboard...');
            
            try {
                await Promise.all([
                    loadDashboardStatus(),
                    loadUsers(),
                    loadItems(),
                    loadCategories()
                ]);
                
                console.log('‚úÖ Dashboard loaded successfully');
                
            } catch (error) {
                console.error('‚ùå Dashboard loading failed:', error);
                showError('Failed to load dashboard: ' + error.message);
            }
        }

        // Load comprehensive dashboard status
        async function loadDashboardStatus() {
            try {
                console.log('üìä Loading dashboard status...');
                const response = await fetch('/api/dashboard/status');
                const data = await response.json();
                
                if (data.status === 'success') {
                    dashboardData.status = data;
                    updateDashboardDisplay(data);
                } else {
                    throw new Error(data.message || 'Status loading failed');
                }
            } catch (error) {
                console.error('‚ùå Dashboard status loading failed:', error);
                document.getElementById('dashboardStatusContent').innerHTML = 
                    `<div class="error">Failed to load dashboard status: ${error.message}</div>`;
            }
        }

        // Update dashboard display
        function updateDashboardDisplay(data) {
            // Update summary stats
            document.getElementById('totalDatabases').textContent = data.summary.databases_connected;
            document.getElementById('totalTables').textContent = data.summary.total_tables;
            document.getElementById('totalCollections').textContent = data.summary.total_collections;
            document.getElementById('totalRecords').textContent = 
                data.summary.total_mysql_records + data.summary.total_mongodb_records;

            // Create detailed status display
            const statusHTML = `
                <div class="summary-stats">
                    <div class="summary-item">
                        <div class="summary-number">${data.summary.total_tables}</div>
                        <div class="summary-label">MySQL Tables</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-number">${data.summary.total_collections}</div>
                        <div class="summary-label">MongoDB Collections</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-number">${data.summary.total_mysql_records}</div>
                        <div class="summary-label">MySQL Records</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-number">${data.summary.total_mongodb_records}</div>
                        <div class="summary-label">MongoDB Records</div>
                    </div>
                </div>

                <div class="database-grid">
                    <!-- MySQL Database Card -->
                    <div class="database-card mysql-card">
                        <div class="database-header">
                            <div class="database-title">
                                üê¨ MySQL Database
                            </div>
                            <div class="connection-status">
                                <span class="status-dot ${data.mysql.connected ? 'status-connected' : 'status-disconnected'}"></span>
                                <span>${data.mysql.connected ? 'Connected' : 'Disconnected'}</span>
                            </div>
                        </div>
                        
                        <div class="database-info">
                            <div class="info-row">
                                <span class="info-label">Database:</span>
                                <span class="info-value">${data.mysql.database}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Version:</span>
                                <span class="info-value">${data.mysql.version}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Tables:</span>
                                <span class="info-value">${data.mysql.tables}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Users:</span>
                                <span class="info-value">${data.mysql.records.users}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Products:</span>
                                <span class="info-value">${data.mysql.records.products}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Orders:</span>
                                <span class="info-value">${data.mysql.records.orders}</span>
                            </div>
                        </div>

                        ${data.mysql.tablesList.length > 0 ? `
                            <div class="tables-list">
                                <strong>Tables:</strong>
                                ${data.mysql.tablesList.map(table => 
                                    `<div class="table-item">${table}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <!-- MongoDB Database Card -->
                    <div class="database-card mongodb-card">
                        <div class="database-header">
                            <div class="database-title">
                                üçÉ MongoDB Database
                            </div>
                            <div class="connection-status">
                                <span class="status-dot ${data.mongodb.connected ? 'status-connected' : 'status-disconnected'}"></span>
                                <span>${data.mongodb.connected ? 'Connected' : 'Disconnected'}</span>
                            </div>
                        </div>
                        
                        <div class="database-info">
                            <div class="info-row">
                                <span class="info-label">Database:</span>
                                <span class="info-value">${data.mongodb.database}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Collections:</span>
                                <span class="info-value">${data.mongodb.collections}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Categories:</span>
                                <span class="info-value">${data.mongodb.records.categories}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Ratings:</span>
                                <span class="info-value">${data.mongodb.records.ratings}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Transactions:</span>
                                <span class="info-value">${data.mongodb.records.transactions}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Payments:</span>
                                <span class="info-value">${data.mongodb.records.payments}</span>
                            </div>
                        </div>

                        ${data.mongodb.collectionsList.length > 0 ? `
                            <div class="collections-list">
                                <strong>Collections:</strong>
                                ${data.mongodb.collectionsList.map(collection => 
                                    `<div class="collection-item">${collection}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.7); border-radius: 8px; text-align: center;">
                    <strong>Last Updated:</strong> ${new Date(data.timestamp).toLocaleString()}
                </div>
            `;

            document.getElementById('dashboardStatusContent').innerHTML = statusHTML;
        }

        // Load users (keep existing function)
        async function loadUsers() {
            try {
                console.log('üë• Loading users...');
                const response = await fetch('/api/users');
                const data = await response.json();
                
                const contentEl = document.getElementById('usersContent');
                
                if (data.status === 'success' && data.data.length > 0) {
                    contentEl.innerHTML = createSimpleTable(data.data, [
                        'user_id', 'username', 'email', 'full_name', 'role'
                    ]);
                } else {
                    contentEl.innerHTML = '<div class="loading">No users found</div>';
                }
            } catch (error) {
                console.error('‚ùå Users loading failed:', error);
                document.getElementById('usersContent').innerHTML = 
                    `<div class="error">Failed to load users: ${error.message}</div>`;
            }
        }

        // Load items (keep existing function)
        async function loadItems() {
            try {
                console.log('üì¶ Loading items...');
                const response = await fetch('/api/items');
                const data = await response.json();
                
                const contentEl = document.getElementById('itemsContent');
                
                if (data.status === 'success' && data.data.length > 0) {
                    contentEl.innerHTML = createSimpleTable(data.data, [
                        'item_id', 'name', 'description', 'price', 'stock_quantity', 'category_name'
                    ]);
                } else {
                    contentEl.innerHTML = '<div class="loading">No items found</div>';
                }
            } catch (error) {
                console.error('‚ùå Items loading failed:', error);
                document.getElementById('itemsContent').innerHTML = 
                    `<div class="error">Failed to load items: ${error.message}</div>`;
            }
        }

        // Load categories (both MySQL and MongoDB)
        async function loadCategories() {
            try {
                console.log('üìÇ Loading categories...');
                
                // Load MySQL categories
                const mysqlResponse = await fetch('/api/categories');
                const mysqlData = await mysqlResponse.json();
                
                // Load MongoDB categories
                const mongoResponse = await fetch('/api/mongo/categories');
                const mongoData = await mongoResponse.json();
                
                let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';
                
                // MySQL Categories
                html += '<div>';
                html += '<h4 style="margin-bottom: 15px; color: #1976d2;">üê¨ MySQL Categories</h4>';
                if (mysqlData.status === 'success' && mysqlData.data.length > 0) {
                    html += createSimpleTable(mysqlData.data, ['category_id', 'name', 'description', 'item_count']);
                } else {
                    html += '<div class="loading">No MySQL categories found</div>';
                }
                html += '</div>';
                
                // MongoDB Categories
                html += '<div>';
                html += '<h4 style="margin-bottom: 15px; color: #2e7d32;">üçÉ MongoDB Categories</h4>';
                if (mongoData.status === 'success' && mongoData.data.length > 0) {
                    html += createSimpleTable(mongoData.data, ['category_id', 'name', 'desc']);
                } else {
                    html += '<div class="loading">No MongoDB categories found</div>';
                }
                html += '</div>';
                
                html += '</div>';
                
                document.getElementById('categoriesContent').innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Categories loading failed:', error);
                document.getElementById('categoriesContent').innerHTML = 
                    `<div class="error">Failed to load categories: ${error.message}</div>`;
            }
        }

        // Create simple table
        function createSimpleTable(data, columns) {
            if (!data || data.length === 0) {
                return '<div class="loading">No data available</div>';
            }

            let html = '<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
            html += '<thead><tr>';
            
            columns.forEach(col => {
                html += `<th style="padding: 12px; background: #f5f5f5; border: 1px solid #ddd; text-align: left;">${col.replace('_', ' ').toUpperCase()}</th>`;
            });
            
            html += '</tr></thead><tbody>';

            data.slice(0, 10).forEach(row => { // Show only first 10 rows
                html += '<tr>';
                columns.forEach(col => {
                    let value = row[col];
                    if (value === null || value === undefined) value = '-';
                    if (col === 'price' && value !== '-') value = '$' + parseFloat(value).toFixed(2);
                    
                    html += `<td style="padding: 10px; border: 1px solid #eee;">${value}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            
            if (data.length > 10) {
                html += `<p style="text-align: center; margin-top: 10px; color: #666; font-style: italic;">Showing 10 of ${data.length} records</p>`;
            }
            
            return html;
        }

        // Show error
        function showError(message) {
            console.error('Error:', message);
        }

        // Auto-refresh every 2 minutes
        setInterval(loadDashboard, 2 * 60 * 1000);
    </script>
</body>
</html>